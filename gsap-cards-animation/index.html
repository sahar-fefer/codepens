<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GSAP Cards Animation</title>
  </head>
  <section>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@glassesusa/dsm@latest/dist/styles.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <div class="filler"><span>Scroll Down</span></div>
    <section class="perfect-match">
      <h2 class="header">
        Discover glasses that <br class="m-only" />perfectly
        <br class="t-block" />matches you.
      </h2>
    <div class="app-wrapper">
      <div class="app">
        <img
          class="face"
          src="https://optimaxweb.glassesusa.com/image/upload/v1720442068/media/wysiwyg/lp24/pairfect-match-ai/AI-find-your-perfect-match-glassesUSA.jpg"
          alt=""
        />
        <div class="phone">
          <div class="title">
            <span class="poppins">
              <i><b>Pair</b>fect</i> Matchâ„¢
            </span>
            <br />Your Personal Collection
          </div>
          <img
            class="phone-frame"
            src="https://optimaxweb.glassesusa.com/image/upload/v1720442068/media/wysiwyg/lp24/pairfect-match-ai/glassesUSA-AI-pairfect-match.png"
            alt=""
          />
          <div class="face-glasses-wrap">
            <img
              class="face-glasses"
              data-id="0"
              active
              src="https://optimaxweb.glassesusa.com/image/upload/v1720442068/media/wysiwyg/lp24/pairfect-match-ai/ai-choose-muse-kenyon.png"
              alt=""
            />
            <img
              class="face-glasses"
              data-id="0.5"
              src="https://optimaxweb.glassesusa.com/image/upload/v1720442068/media/wysiwyg/lp24/pairfect-match-ai/ai-choose-muse-mitchum.png"
              alt=""
            />
            <img
              class="face-glasses"
              data-id="1"
              src="https://optimaxweb.glassesusa.com/image/upload/v1720442068/media/wysiwyg/lp24/pairfect-match-ai/ai-choose-muse-savvy.png"
              alt=""
            />
          </div>
          <div class="cards-wrapper">
            <div class="card-wrap" data-id="0" active>
              <div class="no">1/10</div>
              <div class="card">
                <div class="check">
                  <svg fill="none" viewBox="0 0 10 10">
                    <path
                      stroke="#fff"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.841"
                      d="M1.133 5.034 4.24 8.222l4.626-6.444"
                    />
                  </svg>
                </div>
                <img
                  class="glasses"
                  src="https://optimaxweb.glassesusa.com/image/upload/v1720442068/media/wysiwyg/lp24/pairfect-match-ai/muse-kenyon-perfect-match.png"
                  alt=""
                />
                <div class="name">Muse Kenyon</div>
              </div>
            </div>
            <div class="card-wrap" data-id="0.5">
              <div class="no">2/10</div>
              <div class="card">
                <div class="check">
                  <svg fill="none" viewBox="0 0 10 10">
                    <path
                      stroke="#fff"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.841"
                      d="M1.133 5.034 4.24 8.222l4.626-6.444"
                    />
                  </svg>
                </div>
                <img
                  class="glasses"
                  src="https://optimaxweb.glassesusa.com/image/upload/v1720442068/media/wysiwyg/lp24/pairfect-match-ai/muse-mitchum-perfect-match.png"
                  alt=""
                />
                <div class="name">Muse Mitchum</div>
              </div>
            </div>
            <div class="card-wrap" data-id="1">
              <div class="no">3/10</div>
              <div class="card">
                <div class="check">
                  <svg fill="none" viewBox="0 0 10 10">
                    <path
                      stroke="#fff"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.841"
                      d="M1.133 5.034 4.24 8.222l4.626-6.444"
                    />
                  </svg>
                </div>
                <img
                  class="glasses"
                  src="https://optimaxweb.glassesusa.com/image/upload/v1720442068/media/wysiwyg/lp24/pairfect-match-ai/muse-savvy-perfect-match.png"
                  alt=""
                />
                <div class="name">Muse Savvy</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <a href="/pairfect_match?ai" class="btn f-center"> Start Now </a>
    </div>
    </section>
    <div class="filler"><span>Scroll UP</span></div>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/lenis@1.0.45-dev.0/dist/lenis.min.js"></script>
    <script>
      const isMobile = window.innerWidth < 768;
      
      let vh = window.innerHeight * 0.01;
      
      document.documentElement.style.setProperty("--vh", `${vh}px`);

          gsap.registerPlugin(ScrollTrigger);

          //////////////// scroll animation ////////////////
          const rootStyle = getComputedStyle(document.documentElement);

          const initSmoothScrolling = () => {
            // Instantiate the Lenis object with specified properties
            lenis = new Lenis({
              lerp: 0.6, // Lower values create a smoother scroll effect
              smoothWheel: true, // Enables smooth scrolling for mouse wheel events
            });

            // Update ScrollTrigger each time the user scrolls
            lenis.on("scroll", () => ScrollTrigger.update());

            // Define a function to run at each animation frame
            const scrollFn = (time) => {
              lenis.raf(time); // Run Lenis' requestAnimationFrame method
              requestAnimationFrame(scrollFn); // Recursively call scrollFn on each frame
            };
            // Start the animation frame loop
            requestAnimationFrame(scrollFn);
          };

          const glassesScroll = () => {
            const cardsWrapper = gsap.utils.toArray(".app .cards-wrapper");
            let maxWidth;

            const leftSpace = parseInt(
              rootStyle.getPropertyValue("--card-left-space")
            );

            const getMaxWidth = () => {
              const cardsWrapperWidth = document.querySelector(
                ".app .cards-wrapper"
              ).offsetWidth;
              const cardWidth =
                document.querySelector(".app .card-wrap").offsetWidth;
              maxWidth = cardsWrapperWidth - cardWidth - leftSpace;
            };
            getMaxWidth();
            ScrollTrigger.addEventListener("refreshInit", getMaxWidth);

            let activeGlassesIndex = 0;

            const roundNum = (num) => {
              return Math.round(num * 10) / 10;
            };

            const setActiveGlasses = (index) => {
              const phone = document.querySelector(".phone");
              const prevActiveGlasses = phone.querySelectorAll(`[active]`);
              const activeGlasses = phone.querySelectorAll(
                `[data-id="${index}"]`
              );

              activeGlassesIndex = index;

              if (prevActiveGlasses && activeGlasses) {
                prevActiveGlasses.forEach((el) => {
                  el.removeAttribute("active");
                });
                activeGlasses.forEach((el) => {
                  el.setAttribute("active", "");
                });
              }
            };

            cardPosition = (self, id) => {
              const index = Math.round(self.progress * 100) / 100;
              if (
                (index > 0.2 && index < 0.3) ||
                (index > 0.7 && index < 0.8)
              ) {
                if (self.direction === 1) {
                  setActiveGlasses(roundNum(index + 0.25));
                } else if (self.direction === -1) {
                  setActiveGlasses(roundNum(index - 0.25));
                }
              }
            };

            gsap.to(cardsWrapper, {
              x: () => `-${maxWidth}`,
              ease: "none",
              scrollTrigger: {
                trigger: ".app-wrapper",
                start: "center center",
                snap: {
                  snapTo: [0, 0.5, 1],
                  duration: { min: 0.1, max: 0.3 },
                  labelsDirectional: true,
                  duration: 0.25,
                  ease: "sine.inOut",
                },
                pin: true,
                scrub: true,
                end: () => `+=${maxWidth}`,
                invalidateOnRefresh: true,
                onUpdate: (self) => {
                  cardPosition(self, "update");
                },
                onSnapComplete: (self) => {
                  setActiveGlasses(self.progress);
                },
              },
            });
          };

          initSmoothScrolling();
          glassesScroll();
        
    </script>
  </body>
</html>
